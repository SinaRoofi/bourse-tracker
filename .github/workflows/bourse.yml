name: Bourse Tracker

ØªØ±ÛŒÚ¯Ø± ØªÙˆØ³Ø· Cloudflare Worker

on:
workflow_dispatch:
inputs:
trigger_source:
description: 'Ù…Ù†Ø¨Ø¹ ØªØ±ÛŒÚ¯Ø±'
required: false
default: 'cloudflare'

jobs:
run-bourse-tracker:
runs-on: ubuntu-latest

steps:  
  # 1. Checkout Ú©Ø¯  
  - name: ğŸ“¥ Checkout repository  
    uses: actions/checkout@v4  

  # 2. Ù†ØµØ¨ Python  
  - name: ğŸ Set up Python 3.11  
    uses: actions/setup-python@v5  
    with:  
      python-version: '3.11'  
      cache: 'pip'  

  # 3. Ù†ØµØ¨ dependencies  
  - name: ğŸ“¦ Install dependencies  
    run: |  
      python -m pip install --upgrade pip  
      pip install -r requirements.txt  
    
  # 4. Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª  
  - name: â„¹ï¸ Display info  
    run: |  
      echo "ğŸ• Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: $(date)"  
      echo "ğŸ Ù†Ø³Ø®Ù‡ Python: $(python --version)"  
      echo "ğŸ“¦ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡:"  
      pip list  
    
  # 5. Ø§Ø¬Ø±Ø§ÛŒ main.py  
  - name: ğŸš€ Run Bourse Tracker  
    env:  
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}  
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}  
      API_BASE_URL: ${{ secrets.API_BASE_URL }}  
    run: |  
      python main.py  
    
  # 6. Ø¢Ù¾Ù„ÙˆØ¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ (Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§)  
  - name: ğŸ“‹ Upload logs  
    if: always()  
    uses: actions/upload-artifact@v4  
    with:  
      name: bourse-logs-${{ github.run_number }}  
      path: bourse_tracker.log  
      retention-days: 7  

  # 7. Ø§Ø¹Ù„Ø§Ù† Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)  
  - name: âŒ Notify on failure  
    if: failure()  
    run: |  
      echo "âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ Bourse Tracker"  
      echo "Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Artifacts Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯"